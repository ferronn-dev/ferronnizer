<?xml version="1.0"?>
<Ui>
  <Frame name="FerronnizerTemplateAura" virtual="true">
    <Size x="20" y="20"/>
    <Layers>
      <Layer level="ARTWORK">
        <Texture parentKey="Icon" setAllPoints="true">
          <TexCoords top="0.07" left="0.07" bottom="0.93" right="0.93"/>
        </Texture>
        <FontString parentKey="Count" inherits="NumberFontNormalSmall">
          <Anchors>
            <Anchor point="BOTTOMRIGHT"/>
          </Anchors>
        </FontString>
      </Layer>
      <Layer level="OVERLAY">
        <!-- Taken from BuffFrame.xml -->
        <Texture parentKey="Border" file="Interface\Buttons\UI-Debuff-Overlays" setAllPoints="true">
          <TexCoords left="0.296875" right="0.5703125" top="0" bottom="0.515625"/>
        </Texture>
      </Layer>
    </Layers>
    <Frames>
      <Cooldown parentKey="Cooldown" inherits="CooldownFrameTemplate" reverse="true"/>
    </Frames>
    <Scripts>
      <OnEnter>
        local unit = self:GetParent():GetParent().unit
        GameTooltip:SetOwner(self, 'ANCHOR_BOTTOMRIGHT')
        GameTooltip:SetUnitAura(unit, self.Index, self.Filter)
        GameTooltip:Show()
      </OnEnter>
      <OnLeave>
        GameTooltip:Hide()
      </OnLeave>
    </Scripts>
  </Frame>
  <Frame name="FerronnizerTemplateAuras" virtual="true">
    <Anchors>
      <Anchor point="TOPLEFT" x="0" y="-60"/>
    </Anchors>
    <Size x="160" y="100"/>
    <Scripts>
      <OnLoad>
        self:RegisterUnitEvent('UNIT_AURA', self:GetParent().unit)
        self.Kids = {}
        for row = 0, 4 do
          for col = 0, 7 do
            local frame = CreateFrame('Frame', nil, self, 'FerronnizerTemplateAura', row * 8 + col + 1)
            frame:SetPoint('TOPLEFT', col * 20, row * -20)
            table.insert(self.Kids, frame)
          end
        end
      </OnLoad>
      <OnEvent>
        local unit = self:GetParent().unit
        local index, filter = 1, 'HELPFUL'
        for _, frame in ipairs(self.Kids) do
          local _, icon, count, dispelType, duration, expiration = UnitAura(unit, index, filter)
          if not icon and filter == 'HELPFUL' then
            index, filter = 1, 'HARMFUL'
            _, icon, count, dispelType, duration, expiration = UnitAura(unit, index, filter)
          end
          if not icon then
            frame.Index, frame.Filter = nil, nil
            frame:Hide()
          else
            frame.Index, frame.Filter = index, filter
            frame:Show()
            frame.Icon:SetTexture(icon)
            frame.Count:SetText(count and count &gt; 0 and count or '')
            if dispelType then
              local color = DebuffTypeColor[dispelType]
              frame.Border:SetVertexColor(color.r, color.g, color.b)
              frame.Border:Show()
            else
              frame.Border:Hide()
            end
            frame.Cooldown:SetCooldown(expiration - duration, duration)
          end
          index = index + 1
        end
      </OnEvent>
    </Scripts>
  </Frame>
</Ui>
